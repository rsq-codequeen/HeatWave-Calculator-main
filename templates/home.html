<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Taylor Series & Heatwave Equation</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>

</head>
<style>
  
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: #2b0f0f;
      color: #fffbea;
      overflow-x: hidden;
      opacity: 0;
      animation: fadeInBody 1.5s ease forwards;
    }

    @keyframes fadeInBody {
      to {
        opacity: 1;
      }
    }

    header {
      background: rgba(43, 15, 15, 0.9);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      width: 100%;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    header.shrink {
      padding: 10px 30px;
    }

    header h1 {
      font-size: 24px;
      color: #ff8c42;
    }

    nav a {
      margin-left: 20px;
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    nav a:hover {
      color: #ff6f00;
    }

    #progress-bar {
      position: fixed;
      top: 0; left: 0;
      height: 4px;
      background: linear-gradient(to right, #ff6f00, #ff9f1c);
      width: 0%;
      z-index: 200;
    }

    .hero {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: relative;
      padding: 0 20px;
      background: linear-gradient(135deg, #2b0f0f, #521414, #d14900);
      background-size: 400% 400%;
      animation: bgMove 20s ease infinite;
    }

    @keyframes bgMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hero-content {
      z-index: 2;
      max-width: 800px;
    }

    .hero h2 {
      font-size: 48px;
      margin-bottom: 20px;
      background: linear-gradient(to right, #ff8c42, #ffd452);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero p {
      font-size: 18px;
      color: #f5d9c5;
      line-height: 1.6;
    }

    .glow:hover {
      text-shadow: 0 0 10px #ff9f1c, 0 0 20px #ff9f1c;
    }

    section {
      padding: 80px 40px;
      text-align: center;
      opacity: 0;
      transform: translateY(30px);
      transition: all 1s ease;
    }

    section.active {
      opacity: 1;
      transform: translateY(0);
    }

    section h3 {
      font-size: 32px;
      margin-bottom: 20px;
      color: #ff9f1c;
    }

    section p {
      max-width: 800px;
      margin: auto;
      font-size: 18px;
      color: #fff0dc;
      line-height: 1.8;
    }
    
    footer {
      background: #2b0f0f;
      padding: 30px 20px;
      text-align: center;
      color: #d0a27b;
      font-size: 14px;
    }

    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      top: 0;
      left: 0;
    }

    @media (max-width: 768px) {
      .hero h2 {
        font-size: 32px;
      }
      nav a {
        margin-left: 10px;
        font-size: 14px;
      }
    }

    /* Add this CSS inside your <style> tag or in a separate CSS file */

#heatwave-form {
  background: rgba(43, 15, 15, 0.85);
  border-radius: 18px;
  padding: 30px 22px 22px 22px;
  max-width: 500px;
  max-height: 800px;
  margin: 32px auto 0 auto;
  box-shadow: 0 6px 32px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
  gap: 8px;
  border: 2px solid #ffd452;
  box-shadow:
    0 0 8px 2px #ffd45288,
    0 6px 32px rgba(0,0,0,0.25);
  transition: box-shadow 0.3s, border-color 0.3s;

   position: relative;
  overflow: hidden;
}
#heatwave-form label {
  color: #ffd452;
  font-size: 17px;
  font-weight: 500;
  margin-bottom: 6px;
  text-align: left;
}

#heatwave-form input[type="number"] {
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid #ff9f1c;
  background: #fffbea;
  color: #2b0f0f;
  font-size: 16px;
  font-family: 'Roboto', sans-serif;
  margin-bottom: 10px;
  transition: border-color 0.2s;
}
#calculator-bubbles {
  position: absolute;
  inset: 0;
  z-index: 0;
  border-radius: 16px;
  overflow: hidden;
  pointer-events: none;
  height: 100%;
  width: 100%;
}
#heatwave-form input[type="number"]:focus {
  outline: none;
  border-color: #ff6f00;
}

#heatwave-form button {
  background: linear-gradient(90deg, #ff8c42 0%, #ffd452 100%);
  color: #2b0f0f;
  font-size: 18px;
  font-weight: 700;
  border: none;
  border-radius: 8px;
  padding: 12px 0;
  cursor: pointer;
  margin-top: 10px;
  transition: background 0.2s, color 0.2s;
}

#heatwave-form button:hover {
  background: linear-gradient(90deg, #ff9f1c 0%, #ff6f00 100%);
  color: #fffbea;
}
#heatwave-form > *:not(#calculator-bubbles) {
  position: relative;
  z-index: 1;
}
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px 24px;
  margin-bottom: 18px;
}
.form-grid > div {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}
.form-grid label {
  margin-bottom: 6px;
  color: #ffd452;
  font-size: 17px;
  font-weight: 500;
}
.form-grid input[type="number"] {
  width: 100%;
}
@media (max-width: 600px) {
  .form-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }
}
#result {
  margin-top: 24px;
  font-size: 20px;
  color: #ffd452;
  font-weight: 700;
  letter-spacing: 1px;
  min-height: 28px;
  font-family: 'Roboto', sans-serif;
}

@media (max-width: 600px) {
  #heatwave-form {
    padding: 18px 8px 16px 8px;
    max-width: 98vw;
  }
  #result {
    font-size: 17px;
  }
}
#result-popup {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(43, 15, 15, 0.85);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeInPopup 0.5s;
}
#result-popup-2d {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(43, 15, 15, 0.85);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeInPopup 0.5s;
}
@keyframes fadeInPopup {
  from { opacity: 0; }
  to { opacity: 1; }
}
.popup-content {
  background: #2b0f0f;
  border-radius: 18px;
  border: 2px solid #ffd452;
  box-shadow: 0 0 24px 6px #ffd45288, 0 6px 32px rgba(0,0,0,0.25);
  padding: 32px 28px 24px 28px;
  color: #fffbea;
  min-width: 350px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  text-align: center;
}
.close-btn {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 32px;
  color: #ffd452;
  cursor: pointer;
  font-weight: bold;
  transition: color 0.2s;
}
.close-btn:hover {
  color: #ff8c42;
}
.popup-content h2 {
  color: #ffd452;
  margin-bottom: 18px;
}
.popup-content pre {
  background: #1a0707;
  color: #ffd452;
  padding: 10px;
  border-radius: 8px;
  font-size: 16px;
  margin-top: 18px;
  text-align: left;
  overflow-x: auto;
}

#heatwave-2d-form {
  background: rgba(43, 15, 15, 0.85);
  border-radius: 18px;
  padding: 30px 22px 22px 22px;
  max-width: 500px;
  max-height: 800px;
  margin: 32px auto 0 auto;
  box-shadow: 0 6px 32px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
  gap: 8px;
  border: 2px solid #ffd452;
  box-shadow:
    0 0 8px 2px #ffd45288,
    0 6px 32px rgba(0,0,0,0.25);
  transition: box-shadow 0.3s, border-color 0.3s;
  position: relative;
  overflow: hidden;
}
#heatwave-2d-form label {
  color: #ffd452;
  font-size: 17px;
  font-weight: 500;
  margin-bottom: 6px;
  text-align: left;
}
#heatwave-2d-form input[type="number"] {
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid #ff9f1c;
  background: #fffbea;
  color: #2b0f0f;
  font-size: 16px;
  font-family: 'Roboto', sans-serif;
  margin-bottom: 10px;
  transition: border-color 0.2s;
  width: 100%;
}
#heatwave-2d-form input[type="number"]:focus {
  outline: none;
  border-color: #ff6f00;
}
#heatwave-2d-form button {
  background: linear-gradient(90deg, #ff8c42 0%, #ffd452 100%);
  color: #2b0f0f;
  font-size: 18px;
  font-weight: 700;
  border: none;
  border-radius: 8px;
  padding: 12px 0;
  cursor: pointer;
  margin-top: 10px;
  transition: background 0.2s, color 0.2s;
}
#heatwave-2d-form button:hover {
  background: linear-gradient(90deg, #ff9f1c 0%, #ff6f00 100%);
  color: #fffbea;
}
#heatwave-2d-form > *:not(#calculator-bubbles-2d) {
  position: relative;
  z-index: 1;
}
#calculator-bubbles-2d {
  position: absolute;
  inset: 0;
  z-index: 0;
  border-radius: 16px;
  overflow: hidden;
  pointer-events: none;
  height: 100%;
  width: 100%;
}

 ol{
  text-align: left;
  margin: 20px auto;
  padding-left: 20px;
  max-width: 800px;
  color: #ffd452;
  border: 1px solid #ff9f1c;
  padding: 35px;
  box-shadow:
    0 0 8px 2px #ffd45288,
    0 6px 32px rgba(0,0,0,0.35);
}
.centered-role {
  text-align: center;
  margin: 30px auto 0 auto;
  max-width: 1000px;
  font-size: 18px;
 
  line-height: 1.7;
}
.centered-role b {
 
  font-size: 19px;
  display: block;
  margin-top: 12px;
}
</style>
<body>

<div id="progress-bar"></div>

<header>
  <h1>Heat Equation:Forier Series</h1>
  <nav>
    <a href="#home">Home</a>
    <a href="#taylor">Forier Series</a>
    <a href="#heatwave">Heat Equation</a>
    <a href="#application">Application</a>
    <a href="#calculator1d">1D Calculator</a>
    <a href="#calculator2d">2D Calculator</a>
  </nav>
</header>

<section class="hero" id="home">
  <div id="particles-js"></div>
  <div class="hero-content">
    <h2>Application of Forier Series in the Heat Equation</h2>
    <p>
      Explore how Forier Series helps solve and approximate solutions in the heatwave (heat conduction) equationâ€”crucial in thermal physics and engineering.
    </p>
  </div>
</section>

<section id="taylor">
  <h3 class="glow">What is the Forier Series?</h3>
  <p>
   A Fourier series represents a periodic function as a sum of sine and cosine functions, essentially breaking down a complex wave into its fundamental and harmonic frequencies.
    <br>
    <code>

a<sub>0</sub> = (1/l) &int;<sub>-l</sub><sup>l</sup> f(x) dx
<br>
      a<sub>n</sub> = (1/l) &int;<sub>-l</sub><sup>l</sup> f(x) cos(n&pi;x/l) dx, &nbsp; n = 0, 1, 2, ...
      <br>
  b<sub>n</sub> = (1/l) &int;<sub>-l</sub><sup>l</sup> f(x) sin(n&pi;x/l) dx,&nbsp; n = 1, 2, ...
  <br>
  f(x) = a<sub>0</sub>/2 + &sum;<sup>&infin;</sup><sub>n=1</sub> [ a<sub>n</sub> cos(n&pi;x/l) + b<sub>n</sub> sin(n&pi;x/l) ]

</code>
   
    <br>
    
  <ol>
    <li>f(x): This represents the function you want to express in terms of sine and cosine functions.</li>
    <li>aâ‚€/2: Constant term (average value over one period), normalized by 1/2.</li>
    <li>Î£: Summation symbol, adding terms from n=1 to âˆž.</li>
    <li>aâ‚™ cos(nÏ‰x): Cosine component with amplitude aâ‚™ for the nth harmonic</li>
    <li>bâ‚™ sin(nÏ‰x): Sine component with amplitude bâ‚™ for the nth harmonic.</li>
  </ol>
  This approximation becomes more accurate with more terms, <br>
  and itâ€™s especially useful in physics and engineering to solve differential equations analytically or numerically.
  </p>
</section>

<section id="heatwave">
  <h3 class="glow">What is the Heat Equation?</h3>
  <p>
    Also known as the heat or diffusion equation, it describes how heat (or variation in temperature) diffuses through a medium over time. The 1D form is:
    <br>
    <code>âˆ‚u/âˆ‚t = Î± âˆ‚Â²u/âˆ‚xÂ²</code>
    <br>
    Here, <code>u(x,t)</code> is temperature, and <code>Î±</code> is thermal diffusivity. Itâ€™s widely used in meteorology, engineering, and environmental science to model temperature spread.
  </p>
  <ol>
    <li><b>âˆ‚u/âˆ‚t:</b>  This term represents the rate of change of the quantity \( u \) with respect to time \( t \).
       In the context of heat, \( u \) could represent the temperature at a given position.</li>
    <li><b>âˆ‚Â²u/âˆ‚xÂ²:</b> This term represents the second derivative of \( u \) with respect to position \( x \). It reflects how the temperature changes over space, 
      specifically how the rate of change of temperature is itself changing, which is a measure of the curvature of the temperature profile.</li>
    <li><b>Î± (alpha):</b> This is a constant that is typically called the thermal diffusivity. It dictates how fast heat will spread through the material. 
      A higher value of \( Î± \) means that heat diffuses more quickly.</li>
  </ol>
  <p>
    the heat equation states that the rate of change of temperature at a point is proportional to the curvature of the temperature distribution at that point, scaled by the constant ( Î± ). 
    This means that if a point is hotter or cooler than its neighbors, it will change temperature over time until it approaches a more uniform distribution, showing the natural flow of heat in a medium.
  </p>
</section>

<section id="application">
  <h3 class="glow">Application of Forier Series in Heatwave Equation</h3>
  <p>
    The Forier Series helps solve the heatwave equation numerically. For instance, we can predict temperature at the next time step <code>t + Î”t</code> using:
    
    <ol>
    <u style="color:#ff9f1c;"><li> <b>Hot Water Pipe</b></u><br>
<i><b>Phenomenon:</b></i>
When hot water flows inside a pipe, the pipeâ€™s surface also becomes hot. Over time, this heat spreads through the pipe and to the air outside.
<br>
<i><b>How it works:</b></i>
Heat moves from the hot water to the pipe wall and then slowly moves out to the cooler outside air. This causes the temperature inside the pipe and around it to change over time.
</li>
<li>
 <u style="color:#ff9f1c;"> <b> Mobile Phone Heating</b></u><br>
<i><b>Phenomenon:</b></i>
When you use a mobile phone for a long time or charge it, it starts to heat up because the battery and processor produce heat.
<br>
<i><b>How it works:</b></i>
The heat generated inside the phone spreads through its parts, making the phone warm. If the heat is not controlled, it can damage the phone or make it uncomfortable to hold.
</li>
    </ol>
    <div class="centered-role">
    <b>
    Role of Heat Equation:</b>
The heat equation helps us understand how heat moves through the pipe material and through inside the phone over time and distance.

<b>
Role of Fourier Series:</b>
Because the heat equation is difficult to solve directly,  we use Fourier series to break the temperature pattern into simple waves. Adding these waves together gives the full picture of how temperature changes in the pipe.
</div>
  </p>
</section>

<section id="calculator1d">
  <h3 class="glow">Heatwave Calculator</h3>
  <p>
    Use the calculator below to compute the temperature at a given point and time using the Fourier series approximation.
  </p>
 <form id="heatwave-form" action="/calculate" method="post">
  <div id="calculator-bubbles"></div>
  <div class="form-grid">
    <div>
      <label for="length">Length of rod (l):<p style="color: white; font-size: small;">try 5</p> </label>
      <input type="number" id="length" name="length" required>
    </div>
    <div>
      <label for="time-step">Time step (Î”t): <p style="color: white; font-size: small;">try 500</p></label>
      <input type="number" id="time-step" name="time-step" required>
    </div>
    <div>
      <label for="spatial-steps">Spatial points (Î”x): <p style="color: white; font-size: small;">try 500</p></label>
      <input type="number" id="spatial-steps" name="spatial-steps" required>
    </div>
    <div>
      <label for="alpha">Thermal diffusivity (Î±): <p style="color: white; font-size: small;">try 1 or 0</p></label>
      <input type="number" id="alpha" name="alpha" required>
    </div>
    <div>
      <label for="no_of_steps">Number of steps: <p style="color: white; font-size: small;">try values between 5-20</p></label>
      <input type="number" id="no_of_steps" name="no_of_steps" required>
    </div>
    <div>
      <label for="t_max">Maximum time:<p style="color: white; font-size: small;">try 20</p> </label>
      <input type="number" id="t_max" name="t_max">
    </div>
  </div>
  <button type="submit">Calculate Temperature</button>
</form>
</section>

  <section id="calculator2d">
  <h3 class="glow">2D Heat Equation Calculator (Fourier Series)</h3>
  <p>
    Compute the temperature distribution on a 2D plate over time using the Fourier series solution to the 2D heat equation.
  </p>
  <form id="heatwave-2d-form" action="/calculate2d" method="post">
  <div id="calculator-bubbles-2d"></div>
  <div class="form-grid">
  <div>
    <label for="Lx">Length in x-direction (L<sub>x</sub>):</label>
    <input type="number" id="Lx" name="Lx" step="any" required>
  </div>
  <div>
    <label for="Ly">Length in y-direction (L<sub>y</sub>):</label>
    <input type="number" id="Ly" name="Ly" step="any" required>
  </div>
  <div>
    <label for="Nx">Spatial points in x (N<sub>x</sub>):</label>
    <input type="number" id="Nx" name="Nx" required>
  </div>
  <div>
    <label for="Ny">Spatial points in y (N<sub>y</sub>):</label>
    <input type="number" id="Ny" name="Ny" required>
  </div>
  <div>
    <label for="Nt">Number of time steps (N<sub>t</sub>):</label>
    <input type="number" id="Nt" name="Nt" required>
  </div>
  <div>
    <label for="alpha2d">Thermal diffusivity (&alpha;):</label>
    <input type="number" id="alpha2d" name="alpha2d" step="any" required>
  </div>
  <div>
    <label for="M2d">Number of Fourier terms (M):</label>
    <input type="number" id="M2d" name="M2d" required>
  </div>
  <div>
    <label for="tmax2d">Maximum time <br> (t<sub>max</sub>):</label>
    <input type="number" id="tmax2d" name="tmax2d" step="any" required>
  </div>
</div>
    </div>
  <button type="submit">Calculate 2D Temperature</button>
</form>
  <div id="result-2d"></div>
</section>
<footer>
  Â© 2025 Forier Heatwave Project | Seemoan , Rida , Laiba , Farah , Maria 
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
  particlesJS('particles-js', {
    particles: {
      number: { value: 80 },
      color: { value: '#ff6f00' },
      shape: { type: 'circle' },
      opacity: { value: 0.4 },
      size: { value: 3 },
      move: { enable: true, speed: 1, direction: 'top', out_mode: 'out' }
    },
    interactivity: {
      events: { onhover: { enable: true, mode: 'repulse' } },
      modes: { repulse: { distance: 100 } }
    },
    retina_detect: true
  });
  
  particlesJS('calculator-bubbles', {
  particles: {
    number: { value: 40 }, // Increased from 18 to 40
    color: { value: '#ffd452' },
    shape: { type: 'circle' },
    opacity: { value: 0.25 },
    size: { value: 12, random: true },
    move: { enable: true, speed: 1.5, direction: 'top', out_mode: 'out' } // Increased speed
  },
  interactivity: { events: {} },
  retina_detect: true
});
particlesJS('calculator-bubbles-2d', {
  particles: {
    number: { value: 40 },
    color: { value: '#ffd452' },
    shape: { type: 'circle' },
    opacity: { value: 0.25 },
    size: { value: 12, random: true },
    move: { enable: true, speed: 1.5, direction: 'top', out_mode: 'out' }
  },
  interactivity: { events: {} },
  retina_detect: true
});
  // Scroll animation
  window.addEventListener('scroll', () => {
    document.querySelectorAll('section').forEach(section => {
      const top = section.getBoundingClientRect().top;
      if (top < window.innerHeight - 100) {
        section.classList.add('active');
      }
    });

    // Shrink header
    const header = document.querySelector('header');
    header.classList.toggle('shrink', window.scrollY > 20);

    // Progress bar
    const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
    document.getElementById('progress-bar').style.width = scrolled + '%';
  });
</script>
<!-- Add Chart.js for animated graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('heatwave-form').addEventListener('submit', async function(event) {
  event.preventDefault();

  // Gather form data
  const form = event.target;
  const formData = new FormData(form);

  // Send AJAX request to Flask
  const response = await fetch('/calculate', {
    method: 'POST',
    body: formData
  });
  const data = await response.json();

  // Show popup with results and graph
  showResultPopup(data);
});
function showResultPopup(data) {
  // Remove existing popup if any
  let oldPopup = document.getElementById('result-popup');
  if (oldPopup) oldPopup.remove();

  // Create popup container
  const popup = document.createElement('div');
  popup.id = 'result-popup';
  popup.innerHTML = `
    <div class="popup-content">
      <span class="close-btn" onclick="document.getElementById('result-popup').remove()">&times;</span>
      <h2>Calculation Result</h2>
      <div class="chart-container">
        <canvas id="resultChart" width="400" height="250"></canvas>
        <div id="timeLabel" style="text-align: center;">Time: ${data.t_values[0].toFixed(2)}</div>
      </div>
      <h4>Fourier Coefficients (Bâ‚™):</h4>
      <pre>${data.B_n.map((v, i) => `B<sub>${i+1}</sub> = ${v.toFixed(4)}`).join('\n')}</pre>
    </div>
  `;
  document.body.appendChild(popup);

  // Create chart
  const ctx = document.getElementById('resultChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.x.map(x => x.toFixed(2)),
      datasets: [{
        label: 'Temperature Evolution',
        data: data.u_history[0],
        borderColor: '#ff8c42',
        backgroundColor: 'rgba(255, 212, 82, 0.2)',
        borderWidth: 3,
        pointRadius: 0,
        fill: true
      }]
    },
    options: {
      animation: false,
      scales: {
        x: { title: { display: true, text: 'Position (x)' } },
        y: { 
          title: { display: true, text: 'Temperature' },
          min: 0,
          max: Math.max(...data.u_history[0]) * 1.1
        }
      }
    }
  });

  // Animate through u_history
  let frame = 0;
  const totalFrames = data.u_history.length;
  const timeLabel = document.getElementById('timeLabel');
  let animationId;

  function animate() {
    if (frame < totalFrames) {
      chart.data.datasets[0].data = data.u_history[frame];
      timeLabel.textContent = `Time: ${data.t_values[frame].toFixed(2)}`;
      chart.update('none');
      frame++;
      animationId = setTimeout(animate, 40); // ~25 FPS
    }
  }

  animate();

  // Stop animation if popup is closed
  popup.querySelector('.close-btn').onclick = function() {
    document.getElementById('result-popup').remove();
    if (animationId) clearTimeout(animationId);
  };
}
</script>

<!-- sdk -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
document.getElementById('heatwave-2d-form').addEventListener('submit', async function(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const response = await fetch('/calculate2d', { method: 'POST', body: formData });
  const data = await response.json();
  show2DPopup(data);
  
});

function show2DPopup(data) {
  // Remove existing popup if any
  let oldPopup = document.getElementById('result-popup-2d');
  if (oldPopup) oldPopup.remove();

  // Create popup container
  const popup = document.createElement('div');
  popup.id = 'result-popup-2d';
popup.innerHTML = `
  <div class="popup-content">
    <span class="close-btn" onclick="document.getElementById('result-popup-2d').remove()">&times;</span>
    <h2>2D Heat Equation Animation</h2>
    <div id="plotly-2d" style="width: 500px; height: 400px;"></div>
    <div id="timeLabel2d" style="text-align:center; margin-top:10px;">Time: ${data.t_values[0].toFixed(2)}</div>
    <h4>Fourier Coefficients (A<sub>mn</sub>):</h4>
    <pre style="max-height:200px;overflow:auto;">${data.A_mn.map(
      (row, m) => row.map((val, n) => `A<sub>${m+1},${n+1}</sub>=${val.toExponential(3)}`).join('   ')
    ).join('\n')}</pre>
  </div>
`;
  document.body.appendChild(popup);

  // Prepare initial frame
  const x = data.x;
  const y = data.y;
  const u_history = data.u_history;
  const t_values = data.t_values;
  let frame = 0;

  Plotly.newPlot('plotly-2d', [{
    z: u_history[0],
    x: x,
    y: y,
    type: 'surface',
    colorscale: 'Viridis'
  }], {
    title: 'Temperature Distribution',
    scene: {
      xaxis: { title: 'x' },
      yaxis: { title: 'y' },
      zaxis: { title: 'Temperature', range: [0, 1] }
    }
  });

  // Animate
  let animationId;
  function animate() {
    if (frame < u_history.length) {
      Plotly.update('plotly-2d', {z: [u_history[frame]]});
      document.getElementById('timeLabel2d').textContent = `Time: ${t_values[frame].toFixed(2)}`;
      frame++;
      animationId = setTimeout(animate, 50);
    }
  }
  animate();

  // Stop animation if popup is closed
  popup.querySelector('.close-btn').onclick = function() {
    document.getElementById('result-popup-2d').remove();
    if (animationId) clearTimeout(animationId);
  };
}
</script>
</body>
</html>
